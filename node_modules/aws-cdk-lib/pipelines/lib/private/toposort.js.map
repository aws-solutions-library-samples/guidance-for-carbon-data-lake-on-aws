{
  "version": 3,
  "sources": ["toposort.ts"],
  "sourcesContent": ["export type KeyFunc<T> = (x: T) => string;\nexport type DepFunc<T> = (x: T) => string[];\n\n/**\n * Return a topological sort of all elements of xs, according to the given dependency functions\n *\n * Dependencies outside the referenced set are ignored.\n *\n * Not a stable sort, but in order to keep the order as stable as possible, we'll sort by key\n * among elements of equal precedence.\n *\n * Returns tranches of elements of equal precedence.\n */\nexport function topologicalSort<T>(xs: Iterable<T>, keyFn: KeyFunc<T>, depFn: DepFunc<T>): T[][] {\n  const remaining = new Map<string, TopoElement<T>>();\n  for (const element of xs) {\n    const key = keyFn(element);\n    remaining.set(key, { key, element, dependencies: depFn(element) });\n  }\n\n  const ret = new Array<T[]>();\n  while (remaining.size > 0) {\n    // All elements with no more deps in the set can be ordered\n    const selectable = Array.from(remaining.values()).filter(e => e.dependencies.every(d => !remaining.has(d)));\n\n    selectable.sort((a, b) => a.key < b.key ? -1 : b.key < a.key ? 1 : 0);\n\n    // If we didn't make any progress, we got stuck\n    if (selectable.length === 0) {\n      throw new Error(`Could not determine ordering between: ${Array.from(remaining.keys()).join(', ')}`);\n    }\n\n    ret.push(selectable.map(s => s.element));\n\n    for (const selected of selectable) {\n      remaining.delete(selected.key);\n    }\n  }\n\n  return ret;\n}\n\ninterface TopoElement<T> {\n  key: string;\n  dependencies: string[];\n  element: T;\n}\n"],
  "mappings": "mGAaA,yBAAmC,GAAiB,MAAmB,MAAiB,CACtF,KAAM,WAAY,GAAI,KACtB,SAAW,WAAW,IAAI,CACxB,KAAM,KAAM,MAAM,SAClB,UAAU,IAAI,IAAK,CAAE,IAAK,QAAS,aAAc,MAAM,WAGzD,KAAM,KAAM,GAAI,OAChB,KAAO,UAAU,KAAO,GAAG,CAEzB,KAAM,YAAa,MAAM,KAAK,UAAU,UAAU,OAAO,GAAK,EAAE,aAAa,MAAM,GAAK,CAAC,UAAU,IAAI,KAKvG,GAHA,WAAW,KAAK,CAAC,EAAG,IAAM,EAAE,IAAM,EAAE,IAAM,GAAK,EAAE,IAAM,EAAE,IAAM,EAAI,GAG/D,WAAW,SAAW,EACxB,KAAM,IAAI,OAAM,yCAAyC,MAAM,KAAK,UAAU,QAAQ,KAAK,SAG7F,IAAI,KAAK,WAAW,IAAI,GAAK,EAAE,UAE/B,SAAW,YAAY,YACrB,UAAU,OAAO,SAAS,KAI9B,MAAO,KA1BT,QAAA,gBAAA",
  "names": []
}
