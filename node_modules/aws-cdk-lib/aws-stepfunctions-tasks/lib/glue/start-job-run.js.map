{
  "version": 3,
  "sources": ["start-job-run.ts"],
  "sourcesContent": ["import * as iam from '../../../aws-iam';\nimport * as sfn from '../../../aws-stepfunctions';\nimport { Duration, Stack } from '../../../core';\nimport { Construct } from 'constructs';\nimport { integrationResourceArn, validatePatternSupported } from '../private/task-utils';\n\n/**\n * Properties for starting an AWS Glue job as a task\n */\nexport interface GlueStartJobRunProps extends sfn.TaskStateBaseProps {\n\n  /**\n   * Glue job name\n   */\n  readonly glueJobName: string;\n\n  /**\n   * The job arguments specifically for this run.\n   *\n   * For this job run, they replace the default arguments set in the job\n   * definition itself.\n   *\n   * @default - Default arguments set in the job definition\n   */\n  readonly arguments?: sfn.TaskInput;\n\n  /**\n   * The name of the SecurityConfiguration structure to be used with this job run.\n   *\n   * This must match the Glue API\n   * @see https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-common.html#aws-glue-api-regex-oneLine\n   *\n   * @default - Default configuration set in the job definition\n   */\n  readonly securityConfiguration?: string;\n\n  /**\n   * After a job run starts, the number of minutes to wait before sending a job run delay notification.\n   *\n   * Must be at least 1 minute.\n   *\n   * @default - Default delay set in the job definition\n   */\n  readonly notifyDelayAfter?: Duration;\n}\n\n/**\n * Starts an AWS Glue job in a Task state\n *\n * OUTPUT: the output of this task is a JobRun structure, for details consult\n * https://docs.aws.amazon.com/glue/latest/dg/aws-glue-api-jobs-runs.html#aws-glue-api-jobs-runs-JobRun\n *\n * @see https://docs.aws.amazon.com/step-functions/latest/dg/connect-glue.html\n */\nexport class GlueStartJobRun extends sfn.TaskStateBase {\n  private static readonly SUPPORTED_INTEGRATION_PATTERNS: sfn.IntegrationPattern[] = [\n    sfn.IntegrationPattern.REQUEST_RESPONSE,\n    sfn.IntegrationPattern.RUN_JOB,\n  ];\n\n  protected readonly taskMetrics?: sfn.TaskMetricsConfig;\n  protected readonly taskPolicies?: iam.PolicyStatement[];\n\n  private readonly integrationPattern: sfn.IntegrationPattern;\n\n  constructor(scope: Construct, id: string, private readonly props: GlueStartJobRunProps) {\n    super(scope, id, props);\n    this.integrationPattern = props.integrationPattern ?? sfn.IntegrationPattern.REQUEST_RESPONSE;\n\n    validatePatternSupported(this.integrationPattern, GlueStartJobRun.SUPPORTED_INTEGRATION_PATTERNS);\n\n    this.taskPolicies = this.getPolicies();\n\n    this.taskMetrics = {\n      metricPrefixSingular: 'GlueJob',\n      metricPrefixPlural: 'GlueJobs',\n      metricDimensions: { GlueJobName: this.props.glueJobName },\n    };\n  }\n\n  /**\n   * @internal\n   */\n  protected _renderTask(): any {\n    const notificationProperty = this.props.notifyDelayAfter ? { NotifyDelayAfter: this.props.notifyDelayAfter.toMinutes() } : null;\n    return {\n      Resource: integrationResourceArn('glue', 'startJobRun', this.integrationPattern),\n      Parameters: sfn.FieldUtils.renderObject({\n        JobName: this.props.glueJobName,\n        Arguments: this.props.arguments?.value,\n        Timeout: this.props.timeout?.toMinutes(),\n        SecurityConfiguration: this.props.securityConfiguration,\n        NotificationProperty: notificationProperty,\n      }),\n      TimeoutSeconds: undefined,\n    };\n  }\n\n  private getPolicies(): iam.PolicyStatement[] {\n    let iamActions: string[] | undefined;\n    if (this.integrationPattern === sfn.IntegrationPattern.REQUEST_RESPONSE) {\n      iamActions = ['glue:StartJobRun'];\n    } else if (this.integrationPattern === sfn.IntegrationPattern.RUN_JOB) {\n      iamActions = [\n        'glue:StartJobRun',\n        'glue:GetJobRun',\n        'glue:GetJobRuns',\n        'glue:BatchStopJobRun',\n      ];\n    }\n\n    return [new iam.PolicyStatement({\n      resources: [\n        Stack.of(this).formatArn({\n          service: 'glue',\n          resource: 'job',\n          resourceName: this.props.glueJobName,\n        }),\n      ],\n      actions: iamActions,\n    })];\n  }\n}\n"],
  "mappings": "yNAAA,IAAA,QAAA,oBACA,IAAA,QAAA,8BACA,OAAA,QAAA,iBAEA,aAAA,QAAA,yBAkDA,6BAAqC,KAAI,aAAa,CAWpD,YAAY,MAAkB,GAA6B,MAA2B,QACpF,MAAM,MAAO,GAAI,OADwC,KAAA,MAAA,8FAEzD,KAAK,mBAAkB,IAAG,MAAM,sBAAkB,MAAA,KAAA,OAAA,GAAI,IAAI,mBAAmB,iBAE7E,aAAA,yBAAyB,KAAK,mBAAoB,gBAAgB,gCAElE,KAAK,aAAe,KAAK,cAEzB,KAAK,YAAc,CACjB,qBAAsB,UACtB,mBAAoB,WACpB,iBAAkB,CAAE,YAAa,KAAK,MAAM,cAOtC,aAAW,WACnB,KAAM,sBAAuB,KAAK,MAAM,iBAAmB,CAAE,iBAAkB,KAAK,MAAM,iBAAiB,aAAgB,KAC3H,MAAO,CACL,SAAU,aAAA,uBAAuB,OAAQ,cAAe,KAAK,oBAC7D,WAAY,IAAI,WAAW,aAAa,CACtC,QAAS,KAAK,MAAM,YACpB,UAAS,IAAE,KAAK,MAAM,aAAS,MAAA,KAAA,OAAA,OAAA,GAAE,MACjC,QAAO,IAAE,KAAK,MAAM,WAAO,MAAA,KAAA,OAAA,OAAA,GAAE,YAC7B,sBAAuB,KAAK,MAAM,sBAClC,qBAAsB,uBAExB,eAAgB,QAIZ,aAAW,CACjB,GAAI,YACJ,MAAI,MAAK,qBAAuB,IAAI,mBAAmB,iBACrD,WAAa,CAAC,oBACL,KAAK,qBAAuB,IAAI,mBAAmB,SAC5D,YAAa,CACX,mBACA,iBACA,kBACA,yBAIG,CAAC,GAAI,KAAI,gBAAgB,CAC9B,UAAW,CACT,OAAA,MAAM,GAAG,MAAM,UAAU,CACvB,QAAS,OACT,SAAU,MACV,aAAc,KAAK,MAAM,eAG7B,QAAS,eAjEf,QAAA,gBAAA,uIAC0B,gBAAA,+BAA2D,CACjF,IAAI,mBAAmB,iBACvB,IAAI,mBAAmB",
  "names": []
}
