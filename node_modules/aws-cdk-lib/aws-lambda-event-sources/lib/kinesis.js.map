{
  "version": 3,
  "sources": ["kinesis.ts"],
  "sourcesContent": ["import * as kinesis from '../../aws-kinesis';\nimport * as lambda from '../../aws-lambda';\nimport * as cdk from '../../core';\nimport { StreamEventSource, StreamEventSourceProps } from './stream';\n\nexport interface KinesisEventSourceProps extends StreamEventSourceProps {\n}\n\n/**\n * Use an Amazon Kinesis stream as an event source for AWS Lambda.\n */\nexport class KinesisEventSource extends StreamEventSource {\n  private _eventSourceMappingId?: string = undefined;\n\n  constructor(readonly stream: kinesis.IStream, props: KinesisEventSourceProps) {\n    super(props);\n\n    this.props.batchSize !== undefined && cdk.withResolved(this.props.batchSize, batchSize => {\n      if (batchSize < 1 || batchSize > 10000) {\n        throw new Error(`Maximum batch size must be between 1 and 10000 inclusive (given ${this.props.batchSize})`);\n      }\n    });\n  }\n\n  public bind(target: lambda.IFunction) {\n    const eventSourceMapping = target.addEventSourceMapping(`KinesisEventSource:${cdk.Names.nodeUniqueId(this.stream.node)}`,\n      this.enrichMappingOptions({ eventSourceArn: this.stream.streamArn }),\n    );\n    this._eventSourceMappingId = eventSourceMapping.eventSourceMappingId;\n\n    this.stream.grantRead(target);\n\n    // The `grantRead` API provides all the permissions recommended by the Kinesis team for reading a stream.\n    // `DescribeStream` permissions are not required to read a stream as it's covered by the `DescribeStreamSummary`\n    // and `SubscribeToShard` APIs.\n    // The Lambda::EventSourceMapping resource validates against the `DescribeStream` permission. So we add it explicitly.\n    // FIXME This permission can be removed when the event source mapping resource drops it from validation.\n    this.stream.grant(target, 'kinesis:DescribeStream');\n  }\n\n  /**\n   * The identifier for this EventSourceMapping\n   */\n  public get eventSourceMappingId(): string {\n    if (!this._eventSourceMappingId) {\n      throw new Error('KinesisEventSource is not yet bound to an event source mapping');\n    }\n    return this._eventSourceMappingId;\n  }\n}\n"],
  "mappings": "yNAEA,IAAA,QAAA,cACA,SAAA,QAAA,YAQA,gCAAwC,UAAA,iBAAiB,CAGvD,YAAqB,OAAyB,MAA8B,CAC1E,MAAM,OADa,KAAA,OAAA,OAFb,KAAA,sBAAiC,mKAKvC,KAAK,MAAM,YAAc,QAAa,IAAI,aAAa,KAAK,MAAM,UAAW,WAAY,CACvF,GAAI,UAAY,GAAK,UAAY,IAC/B,KAAM,IAAI,OAAM,mEAAmE,KAAK,MAAM,gBAK7F,KAAK,OAAwB,kEAClC,KAAM,oBAAqB,OAAO,sBAAsB,sBAAsB,IAAI,MAAM,aAAa,KAAK,OAAO,QAC/G,KAAK,qBAAqB,CAAE,eAAgB,KAAK,OAAO,aAE1D,KAAK,sBAAwB,mBAAmB,qBAEhD,KAAK,OAAO,UAAU,QAOtB,KAAK,OAAO,MAAM,OAAQ,6BAMjB,uBAAoB,CAC7B,GAAI,CAAC,KAAK,sBACR,KAAM,IAAI,OAAM,kEAElB,MAAO,MAAK,uBApChB,QAAA,mBAAA",
  "names": []
}
