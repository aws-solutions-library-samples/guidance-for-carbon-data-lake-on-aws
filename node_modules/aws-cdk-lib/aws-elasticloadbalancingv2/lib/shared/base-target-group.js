"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadBalancerNameFromListenerArn=exports.TargetGroupBase=void 0;const jsiiDeprecationWarnings=require("../../../.warnings.jsii.js"),JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti"),cdk=require("../../../core"),constructs_1=require("constructs"),elasticloadbalancingv2_generated_1=require("../elasticloadbalancingv2.generated"),enums_1=require("./enums"),util_1=require("./util");class TargetGroupBase extends constructs_1.Construct{constructor(scope,id,baseProps,additionalProps){super(scope,id);this.loadBalancerAttachedDependencies=new constructs_1.DependencyGroup,this.attributes={},this.targetsJson=new Array,jsiiDeprecationWarnings.aws_cdk_lib_aws_elasticloadbalancingv2_BaseTargetGroupProps(baseProps),baseProps.deregistrationDelay!==void 0&&this.setAttribute("deregistration_delay.timeout_seconds",baseProps.deregistrationDelay.toSeconds().toString()),this.healthCheck=baseProps.healthCheck||{},this.vpc=baseProps.vpc,this.targetType=baseProps.targetType,this.resource=new elasticloadbalancingv2_generated_1.CfnTargetGroup(this,"Resource",{name:baseProps.targetGroupName,targetGroupAttributes:cdk.Lazy.any({produce:()=>util_1.renderAttributes(this.attributes)},{omitEmptyArray:!0}),targetType:cdk.Lazy.string({produce:()=>this.targetType}),targets:cdk.Lazy.any({produce:()=>this.targetsJson},{omitEmptyArray:!0}),vpcId:cdk.Lazy.string({produce:()=>this.vpc&&this.targetType!==enums_1.TargetType.LAMBDA?this.vpc.vpcId:void 0}),healthCheckEnabled:cdk.Lazy.any({produce:()=>{var _b;return(_b=this.healthCheck)===null||_b===void 0?void 0:_b.enabled}}),healthCheckIntervalSeconds:cdk.Lazy.number({produce:()=>{var _b,_c;return(_c=(_b=this.healthCheck)===null||_b===void 0?void 0:_b.interval)===null||_c===void 0?void 0:_c.toSeconds()}}),healthCheckPath:cdk.Lazy.string({produce:()=>{var _b;return(_b=this.healthCheck)===null||_b===void 0?void 0:_b.path}}),healthCheckPort:cdk.Lazy.string({produce:()=>{var _b;return(_b=this.healthCheck)===null||_b===void 0?void 0:_b.port}}),healthCheckProtocol:cdk.Lazy.string({produce:()=>{var _b;return(_b=this.healthCheck)===null||_b===void 0?void 0:_b.protocol}}),healthCheckTimeoutSeconds:cdk.Lazy.number({produce:()=>{var _b,_c;return(_c=(_b=this.healthCheck)===null||_b===void 0?void 0:_b.timeout)===null||_c===void 0?void 0:_c.toSeconds()}}),healthyThresholdCount:cdk.Lazy.number({produce:()=>{var _b;return(_b=this.healthCheck)===null||_b===void 0?void 0:_b.healthyThresholdCount}}),unhealthyThresholdCount:cdk.Lazy.number({produce:()=>{var _b;return(_b=this.healthCheck)===null||_b===void 0?void 0:_b.unhealthyThresholdCount}}),matcher:cdk.Lazy.any({produce:()=>{var _b,_c;return((_b=this.healthCheck)===null||_b===void 0?void 0:_b.healthyHttpCodes)!==void 0||((_c=this.healthCheck)===null||_c===void 0?void 0:_c.healthyGrpcCodes)!==void 0?{grpcCode:this.healthCheck.healthyGrpcCodes,httpCode:this.healthCheck.healthyHttpCodes}:void 0}}),...additionalProps}),this.targetGroupLoadBalancerArns=this.resource.attrLoadBalancerArns,this.targetGroupArn=this.resource.ref,this.targetGroupFullName=this.resource.attrTargetGroupFullName,this.loadBalancerArns=this.resource.attrLoadBalancerArns.toString(),this.targetGroupName=this.resource.attrTargetGroupName,this.defaultPort=additionalProps.port,this.node.addValidation({validate:()=>this.validateTargetGroup()})}get loadBalancerAttached(){return this.loadBalancerAttachedDependencies}configureHealthCheck(healthCheck){jsiiDeprecationWarnings.aws_cdk_lib_aws_elasticloadbalancingv2_HealthCheck(healthCheck),this.healthCheck=healthCheck}setAttribute(key,value){this.attributes[key]=value}addLoadBalancerTarget(props){if(jsiiDeprecationWarnings.aws_cdk_lib_aws_elasticloadbalancingv2_LoadBalancerTargetProps(props),this.targetType!==void 0&&this.targetType!==props.targetType)throw new Error(`Already have a of type '${this.targetType}', adding '${props.targetType}'; make all targets the same type.`);if(this.targetType=props.targetType,this.targetType===enums_1.TargetType.LAMBDA&&this.targetsJson.length>=1)throw new Error("TargetGroup can only contain one LAMBDA target. Create a new TargetGroup.");props.targetJson&&this.targetsJson.push(props.targetJson)}validateTargetGroup(){const ret=new Array;return this.targetType===void 0&&this.targetsJson.length===0&&cdk.Annotations.of(this).addWarning("When creating an empty TargetGroup, you should specify a 'targetType' (this warning may become an error in the future)."),this.targetType!==enums_1.TargetType.LAMBDA&&this.vpc===void 0&&ret.push("'vpc' is required for a non-Lambda TargetGroup"),ret}}exports.TargetGroupBase=TargetGroupBase,_a=JSII_RTTI_SYMBOL_1,TargetGroupBase[_a]={fqn:"aws-cdk-lib.aws_elasticloadbalancingv2.TargetGroupBase",version:"2.15.0"};function loadBalancerNameFromListenerArn(listenerArn){const arnParts=cdk.Fn.split("/",listenerArn);return`${cdk.Fn.select(1,arnParts)}/${cdk.Fn.select(2,arnParts)}/${cdk.Fn.select(3,arnParts)}`}exports.loadBalancerNameFromListenerArn=loadBalancerNameFromListenerArn;
//# sourceMappingURL=base-target-group.js.map
